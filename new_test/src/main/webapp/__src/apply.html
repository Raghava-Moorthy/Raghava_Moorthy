<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<script src="../__control/script.js"></script>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
	<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
	<script src="https://unpkg.com/@turf/turf@6.5.0"></script>
	<script src="https://kit.fontawesome.com/ad7c3f3025.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="../__css/style.css">
	<title>FMS</title>
</head>

<body class="app-da">
	<style>
		.app-da {
			overflow: hidden;
			background-color: #05102b;

		}

		.profile-id {
			font-size: 30px;
			margin-right: 0px;
			position: absolute;
		}

		.g-map {
			margin-left: 5%;
			position: absolute;
		}

		#map {
			border: 5px solid white;
			padding: 12px;
			border-radius: 10px;

		}

		#chart-container {
			width: 600px;
			height: 300px;
			margin-left: 45%;
			position: absolute;
		}

		.exchanger {
			text-transform: capitalize;
			font-size: 35px;
			color: yellow;
			margin-top: 25%;
			margin-left: 45%;
		}

		.update-board {
			margin-left: 60%;
			width: 10%;
			color: #000;
			font-weight: 600;
			font-size: 20px;
			font-family: sans;
			text-transform: capitalize;
			margin-top: 2%;
			outline: none;
			border: none;
			transition: 1s;
		}

		.update-board:hover {
			background: orangered;
			transition: 1.5s;
			scale: 1.1;
			outline: none;
			border: none;
		}

		.refuel {
			color: #fff;
			margin-left: 50%;
			position: absolute;
			
		}

		.refuel::placeholder {
			color: white;
		}
	</style>



	<div class="">
		<ul class="navbar">
			<a href="query.html">
				<li class="nav__list1  list">Queries</li>
			</a>
			<div class="nav__list list w1">
				<a href="profile.jsp"> <i class="fa-regular fa-id-card profile-id circle"
						style="color: #ffffff;"></i></a>
			</div>
		</ul>
	</div>
	<div class="g-map">
		<div id="map" style="width: 500px; height: 400px; top:10px;"></div>
		<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
		<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
	</div>
	<div id="chart-container">
		<canvas id="fuel-chart"></canvas>
	</div>


	<form id="" action="/new_test/dashboard" method="post">
		<p class="exchanger" id="fuel-para">With this fuel you can travel upto X Kilometer</p>

		<input type="text" placeholder="Enter the Re fueled value" id="fuel_text" name="fuel-value" class="refuel" />
		<button type="submit" class="btn btn-warning update-board">Update</button>


	</form>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="script.js"></script>
	<script>
		var x1 = 13.067439, y1 = 80.237617;
		var markers = [];
		var map = L.map('map').setView([x1, y1], 6);
		var googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
			maxZoom: 20,
			subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
		});
		googleStreets.addTo(map);
		var redIcon = L.divIcon({
			className: 'custom-marker-icon',
			html: '<i class="fas fa-map-marker-alt fa-3x" style="color: red;"></i>',
			iconSize: [20, 20]
		});
		var greenIcon = L.divIcon({
			className: 'custom-marker-icon',
			html: '<i class="fas fa-map-marker-alt fa-3x" style="color: green;"></i>',
			iconSize: [20, 20]
		});
		var violetIcon = L.divIcon({
			className: 'custom-marker-icon',
			html: '<i class="fas fa-map-marker-alt fa-3x" style="color: violet;"></i>',
			iconSize: [30, 30]
		});
		var orangeIcon = L.divIcon({
			className: 'custom-marker-icon',
			html: '<i class="fas fa-map-marker-alt fa-3x" style="color: black;"></i>',
			iconSize: [30, 30]
		});
		if ("geolocation" in navigator) {
			navigator.geolocation.getCurrentPosition(function (position) {
				var x = position.coords.latitude;
				var y = position.coords.longitude;
				map.setView([x, y], 10);
				var userMarker = L.marker([x, y]).addTo(map).bindPopup("Your Location");
				const points = [
					{latitude: x1, longitude: y1, type: "public"},
					{latitude: 9.181199500150413, longitude: 77.86388658712417, type: "private"},
					{latitude: 9.175967317137577, longitude: 77.85968088338927, type: "publicContracted"},
					{latitude: 9.175247091569148, longitude: 77.87180446813665, type: "privateCommercial"},
				];
				points.forEach(point => {
					const marker = L.marker([point.latitude, point.longitude], {icon: orangeIcon}).addTo(map);
					markers.push(marker);
				});
			}, function (error) {
				console.error("Error getting user's location:", error.message);
			});
		} else {
			console.error("Geolocation is not supported in this browser.");
		}

		document.addEventListener('DOMContentLoaded', function () {
			var fuelData = {
				labels: ['Day1', 'Day2', 'Day3', 'Day4', 'Day5', 'Day6'],
				datasets: [{
					label: 'Re-Fuel',
					backgroundColor: 'rgba(75, 192, 192, 0.5)',
					borderColor: 'rgba(75, 192, 192, 1)',
					borderWidth: 1,
					data: [6.3, 40, 11.5, 25, 5, 40]
				}]
			};

			var ctx = document.getElementById('fuel-chart').getContext('2d');
			var fuelChart = new Chart(ctx, {
				type: 'bar',
				data: fuelData,
				options: {
					responsive: true,
					scales: {
						y: {
							beginAtZero: true
						}
					}
				}
			});
		});

		function updateFuelValue() {
			var exchangerParagraph = document.querySelector('.exchanger');
			const randomNumber = Math.floor(Math.random() * 17) + 2;
			exchangerParagraph.innerHTML = "With this fuel you can travel upto " + remainingFuel/100*0.13 + " Kilometer";
		}

		updateFuelValue();

		function updateFuelParagraph() {
			// Create a new XMLHttpRequest object
			var xhr = new XMLHttpRequest();

			// Define the function to handle the response
			xhr.onreadystatechange = function () {
				if (xhr.readyState === 4 && xhr.status === 200) {
					// Parse the JSON response
					var response = JSON.parse(xhr.responseText);

					// Get the remaining fuel value from the response
					var remainingFuel = response.remainingFuel;

					// Update the paragraph content
					var fuelParagraph = document.getElementById("fuel-paragraph");
					fuelParagraph.textContent = "With this fuel, you can travel up to " + remainingFuel + " Kilometer";
				}
			};

			// Open a GET request to your servlet
			xhr.open("GET", "/new_test/dashboard", true);

			// Send the request
			xhr.send();
		}

		// Call the updateFuelParagraph function when the page loads
		window.onload = updateFuelParagraph;
	</script>

	</script>


</body>

</html>